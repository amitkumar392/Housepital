<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>user-app-app test</title>


    <script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../node_modules/@polymer/test-fixture/test-fixture.js"></script>
    <script src="../../node_modules/mocha/mocha.js"></script>
    <script src="../../node_modules/chai/chai.js"></script>
    <script src="../../node_modules/wct-mocha/wct-mocha.js"></script>

    <script type="module" src="../../src/Housepital-app/login-page.js"></script>
</head>

<body>

    <test-fixture id="UserListFixture">
        <template>
            <login-page></login-page>
        </template>
    </test-fixture>



    <script>
        describe(' user is login or not ', function () {
            var element;
            var elementShadowRoot;
            var baseUrl;

            describe('When component is rendered', () => {

                beforeEach(function () {
                    element = fixture('UserListFixture');
                    elementShadowRoot = element.shadowRoot;
                });

                it('should render the component', function () {
                    expect(element).to.be.exist;
                    expect(elementShadowRoot).to.be.exist;
                });

                it('should render iron-form component', function () {
                    let ironForm = elementShadowRoot.querySelector('#form')
                    expect(ironForm).to.be.exist;
                    expect(ironForm).to.not.null;
                });

                it('should render phone number field', function () {
                    let name = elementShadowRoot.querySelector('#phone')
                    expect(name).to.be.exist;
                    expect(name).to.not.null;
                });

                it('should render password field', function () {
                    let sapId = elementShadowRoot.querySelector('#pass')
                    expect(sapId).to.be.exist;
                    expect(sapId).to.not.null;
                });



                it('Should render paper-button', function () {
                    var paperButton = elementShadowRoot.querySelector('paper-button');
                    expect(paperButton.innerText).to.equal(('LOGIN'));
                });



                it('Should render iron-ajax', function () {
                    let ironAjax = elementShadowRoot.querySelector('iron-ajax');
                    expect(ironAjax).to.exist;
                });



                describe('when login button is triggered click event', function () {
                    let loginBtn;
                    beforeEach(function () {
                        loginBtn = elementShadowRoot.querySelector('#login');
                        loginBtn.click();
                    });





                });


            });

        });

    

        describe(' When login button is clicked', function () {
            let loginSpy, loginStub;
            var ajax;
            var request;
            var server;
            var responseHeaders = {
                json: { 'Content-Type': 'application/json' }
            };

            beforeEach(function () {
                loginStub = sinon.spy();
                server = sinon.fakeServer.create();

            });

            afterEach(function () {
                server.restore();
            })

            it('should call loginStub()', function (done) {
                let btn = elementShadowRoot.querySelector('paper-button');
                btn.addEventListener('click', loginStub);
                element.mobile = 1234567890;
                element.password = "start@123";
                // element.action = 'list';

                flush(function () {
                    btn.click();
                    expect(loginStub.callCount).to.be.equal(1);
                    done();
                });
            });

            it('should respond with correct response', function (done) {
                ajax = elementShadowRoot.querySelector("iron-ajax");

                request = ajax.generateRequest();
                server.respondWith(
                    'POST',
                    'http://localhost:3000/users', [
                    200,
                    responseHeaders.json,
                    '[{mobile:1234567890}]'
                ]
                );
                flush(function () {
                    console.log(request);
                    debugger;
                    // expect(request.response).to.be.ok;
                    // expect(request.response).to.be.equal('object');

                    server.respond();
                    done();
                });

                // expect(request.response.success).to.be.equal(true);


            });



        });
    </script>


</body>

</html>